stages:
  - stage: build
    displayName: build and push
    jobs:
      - job: docker_build
        steps:
        - task: DockerInstaller@0
          inputs:
            dockerVersion: '17.09.0-ce'
        - task: Docker@2
          inputs:
            containerRegistry: 'docker_test'
            repository: 'DockerTestingImage'
            command: 'buildAndPush'
            Dockerfile: '**/Dockerfile'
            addPipelineData: false
            addBaseImageData: false
        - task: PublishBuildArtifacts@1
          inputs:
            PathtoPublish: '$(Build.ArtifactStagingDirectory)'
            ArtifactName: 'drop'
            publishLocation: 'Container'